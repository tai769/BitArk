
# 背景
一个已读服务，高 QPS，纯粹内存操作，不用磁盘存储。可以通过横向扩容抗更大的量。同时高可用，不能因为重启宕机丢数据。不能用 Redis 之类的。
第一 集群全部崩溃 可以恢复
第二单节点挂了 可以依旧对外提供服务，单节点恢复了可以加回来
第三 我一个节点内存有限
第四 我要区分多个业务已读
第五 我要有个好的对外接口
# 目标

1.纯内存操作：数据读写都在内存中
2.节点宕机可恢复：利用集群和 WAL
3.横向扩容：动态增加节点数量和重新分配（我理解的）
4.业务隔离：区分多个业务的已读
5.设计好的对外接口
# 系统整体架构

### 模块划分

1.网络连接层：处理网络连接
2.存储引擎层：WAL + 内存管理
3.集群管理：主从节点，以及分片功能
4.业务层：已读服务的读写逻辑
5.启动层：服务启动和关闭
### 技术架构

![[Pasted image 20251129203831.png]]
# 详细设计

### 核心服务流程图

![[Pasted image 20251129221450.png]]
### 数据恢复流程图

![[Pasted image 20251129223552.png]]
### 异常处理流程

![[Pasted image 20251129232305.png]]
### 领域划分

**1.已读领域**

已读服务中业务的含义就是针对已读的读写所以在已读领域我们关注的应该是已读状态的表示方法，因为在描述的第四点中提到了我要区分多个业务已读，所以需要不同业务的隔离。
这里并不需要我们关注数据的存储和节点的同步。

**2.存储领域**

存储方面我们只需要关注数据的存放，持久化机制的保证，节点数据的恢复。

**3.集群领域**

集群关注的是多个节点互相的沟通包括了节点的健康监测，数据复制，一致性保证。

**4.路由领域**

关注请求访问时应该路由到哪一节点哪一分片。